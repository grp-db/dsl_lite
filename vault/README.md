# Vault - OCSF Template Utilities

This folder contains utility scripts for maintaining and validating OCSF YAML templates.

## Scripts

### `check_template_fields.py`
Compares OCSF table schemas defined in `notebooks/create_ocsf_tables.py` with the corresponding YAML templates in `ocsf_templates/`. 

**Usage:**
```bash
python3 vault/check_template_fields.py
```

**Output:**
- Lists all tables checked
- Shows missing fields for each table
- Provides a summary of total missing fields

### `add_missing_fields.py`
Automatically adds missing fields from the table definitions to the YAML templates.

**Usage:**
```bash
python3 vault/add_missing_fields.py
```

**What it does:**
- Reads table schemas from `notebooks/create_ocsf_tables.py`
- Compares with existing YAML templates
- Adds missing fields with appropriate TODO comments
- Preserves existing YAML structure and formatting
- Inserts fields before the metadata section

**Note:** This script modifies the YAML templates in place. Make sure to review changes before committing.

### `standardize_category_class.py`
Standardizes the category & class section across all OCSF YAML templates to match the format from [OCSF schema](https://schema.ocsf.io/).

**Usage:**
```bash
python3 vault/standardize_category_class.py
```

**What it does:**
- Ensures all templates use the standardized format:
  ```yaml
  # Category & Class
  - name: category_name
    literal: <Category Name>
  - name: category_uid
    expr: CAST(<uid> AS INT)
  - name: class_name
    literal: <Class Name>
  - name: class_uid
    expr: CAST(<uid> AS INT)
  ```
- Updates category and class UIDs to match the official OCSF schema
- Ensures consistent ordering (category_name, category_uid, class_name, class_uid)
- Uses `expr: CAST(X AS INT)` for UIDs instead of `literal: X`

**Note:** This script modifies the YAML templates in place. Based on the OCSF schema at https://schema.ocsf.io/

### `update_templates.py`
Legacy script for fixing duplicate metadata sections in OCSF templates. 

**Note:** This script has been superseded by `add_missing_fields.py` and `standardize_category_class.py`, but is kept for reference. The functionality has been integrated into the newer scripts.

### `field_comparison_report.txt`
A detailed report generated by `check_template_fields.py` showing:
- All missing fields per table
- Field counts and statistics
- Summary of most commonly missing fields

## When to Use

- **After updating `create_ocsf_tables.py`**: Run `check_template_fields.py` to see if templates need updates
- **Before a release**: Run `check_template_fields.py` to ensure all templates are complete
- **To sync templates with table definitions**: Run `add_missing_fields.py` to automatically add missing fields

## Field Categories

The scripts identify several categories of commonly missing fields:

1. **Common OCSF fields** (missing in many tables):
   - `enrichments`, `observables`, `unmapped` - Advanced/extensibility fields
   - `status_code`, `status_detail` - Status information
   - `action`, `action_id` - Action tracking
   - `severity`, `timezone_offset` - Event metadata

2. **Table-specific fields**:
   - Fields unique to certain event types
   - Nested STRUCT fields that may be partially represented

## Notes

- The scripts skip `dsl_id` as it's auto-generated
- Nested fields (e.g., `metadata.version`) are handled specially
- Fields are inserted before the metadata section to maintain logical grouping

