# OCSF Gold Mapping Template: user_access
# Class UID: 3005 | Category: Identity & Access Management
#
# User Access events capture resource access attempts and permissions.

gold:
  # Note: clusterBy is supported in dsl_spark.py mode but not in SDP mode (sinks don't support it atm)
  # For SDP mode, run ALTER TABLE after pipeline creation:
  #   ALTER TABLE <catalog>.<database>.user_access CLUSTER BY (time, user.name)
  - name: user_access
    input: <YOUR_SILVER_TABLE_NAME>
    # clusterBy: ["time", "user.name"]  # Only works in dsl_spark.py mode
    fields:
      - name: activity_id
        expr: # 1=Access Grant, 2=Access Revoke, 3=Access Denied, 4=Access Error
      - name: activity_name
        expr: 
      - name: category_uid
        literal: 3
      - name: category_name
        literal: Identity & Access Management
      - name: class_uid
        literal: 3005
      - name: class_name
        literal: User Access
      - name: severity_id
        expr: 
      - name: time
        from: 
      - name: type_uid
        expr: 
      - name: type_name
        expr: 
      - name: user.name
        expr: # User accessing resource
      - name: user.uid
        expr: 
      - name: actor.user.name
        expr: # Who granted/revoked access
      - name: actor.user.uid
        expr: 
      - name: resource.name
        expr: # Resource being accessed
      - name: resource.uid
        expr: 
      - name: resource.hostname
        expr: 
      - name: resource.ip
        expr: 
      - name: src_endpoint.ip
        expr: # Source of access attempt
      - name: api.operation
        expr: # Operation attempted
      - name: disposition_id
        expr: # 1=Allowed, 2=Blocked
      - name: disposition
        expr: 
      - name: status_id
        expr: 
      - name: metadata.product.name
        literal: 
      - name: metadata.product.vendor_name
        literal: 
      - name: metadata.logged_time
        from: 
      - name: metadata.processed_time
        expr: current_timestamp()
      - name: metadata.uid
        expr: 
      - name: raw_data
        from: 

